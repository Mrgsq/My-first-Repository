"use strict";$(function(){function a(){var e=getCookie("username");e?new Promise(function(c){$.ajax({type:"post",url:"../api/shoppingCar.php",data:{sqlname:"getCar",username:e},dataType:"json",success:function(e){c(e)}})}).then(function(o){for(var n="",e=function(){var e=o[a].shoppro_id,c=o[a].shoppro_num;$.ajax({type:"post",url:"../api/pro_data.php",data:{id:e},dataType:"json",success:function(e){e.map(function(e){e.stock;n+='\n                            <li class="shop_pro" data-id=\''+e.pro_id+'\'>\n                                    <dl class="product_class">\n                                        <dd>\n                                            <input type="checkbox" name="" id="" class=\'pro_checkbox\'>\n                                            <a href="###" class="imgbox">\n                                                <img src="../img/listimgs/'+e.pro_imgUrl+'.jpg" alt="">\n                                            </a>\n                                            <div class="products_name clearfix">\n                                                <p class="shop_name fl">'+e.pro_name+'</p>\n                                                <p class="shop_spec fr">\n                                                <em>规格：</em>\n                                                <span title="50mg*10s">50mg*10s</span>\n                                                </p>\n\n                                        </div>\n                                        <div class="price_info">\n                                            <p class="pro_price">'+e.pro_nowprice+'.00</p>\n                                        </div>\n                                        <div class="shop_nums">\n                                            <a href="###" class="reduce">-</a>\n                                            <input type="text" value="'+c+'" class="shop_pro_nums" data-stock=\''+e.stock+'\'>\n                                            <a href="###" class="increase">+</a>\n                                        </div>\n                                        <div class="xiaoji">'+e.pro_nowprice*c+'.00</div>\n                                        <div class="del">\n                                            删除\n                                        </div>\n                                        </dd>\n                                    </dl>\n                                    </li>\n                                 ',$(".orderbox").html(n)})}})},a=0;a<o.length;a++)e()}):alert("请先登录账号！")}$(".header").load("header.html"),$("#footer").load("footer.html"),getCookie("username")?$(".my_cart_log").css("display","none"):($("my_cart_log").css("display","block"),$("#login").click(function(){var e=location.href;setCookie("url",e),location.href="login.html",console.log(e)})),a(),$(".orderbox").bind("click",$(".shop_nums"),function(e){var c=$(e.target);console.log(c);var o=c.parent().find($(".shop_pro_nums")).data("stock"),n=c.parent().find($(".shop_pro_nums")).val(),a=c.parent().parent().parent().parent().data("id"),r=c.parent().parent().find($(".pro_price")).html();c.parent().parent().find($(".xiaoji")),"increase"==c.attr("class")?o<++n&&(n=o,alert("超出库存")):"reduce"==c.attr("class")&&--n<1&&(n=1,alert("不能少于一件")),$.ajax({type:"post",url:"../api/shoppingCar.php",data:{sqlname:"setNum",num:n,shoppro_id:a},success:function(e){}});var p=n*r;c.parent().find($(".shop_pro_nums")).val(n),c.parent().parent().find($(".xiaoji")).html(p+".00"),t()}),$(".orderbox").bind("click",$(".shop_pro"),function(e){var c=$(e.target),o=c.parent().parent().parent().data("id");"del"==c.attr("class")&&confirm("你确定要删除这件商品码？")&&(c.parent().parent().parent().remove(),$.ajax({type:"get",url:"../api/shoppingCar.php",data:{sqlname:"remove_pro",shoppro_id:o},success:function(e){"yes"==e?(alert("删除成功"),a()):alert("删除失败")}}))}),$("#check_pro").click(function(){var e=$(this).prop("checked");$(".shopCont input:checkbox").prop("checked",e),t()}),$("#checkall").click(function(){var e=$(this).prop("checked");$(".shopCont input:checkbox").prop("checked",e),t()}),$("#jk_check").click(function(){var e=$(this).prop("checked");$(".shopCont input:checkbox").prop("checked",e),t()});setTimeout(function(){$(".orderbox .pro_checkbox").click(function(){t();var e=$(".orderbox .pro_checkbox").length,c=$(".orderbox .pro_checkbox:checked").length;console.log(e,c),e==c?($("#jk_check").prop("checked",!0),$("#check_pro").prop("checked",!0),$("#checkall").prop("checked",!0)):($("#checkall").prop("checked",!1),$("#jk_check").prop("checked",!1),$("#check_pro").prop("checked",!1))})},2500);function t(){var n=0,a=0;1<=$(".orderbox .pro_checkbox:checked").length?($("#submit").css("background","#e4393c"),$(".orderbox .pro_checkbox:checked").each(function(e,c){var o=$(c);n+=o.parent().find($(".shop_pro_nums")).val()-0,a+=o.parent().find($(".xiaoji")).html()-0,$(".all_num").html(n),$(".total_price").html(a+".00")})):($(".all_num").html(n),$(".total_price").html(a+".00"),$("#submit").css("background","#ccc"))}$(".delcheck").click(function(){var n;confirm("你确定删除这些商品吗？")&&(n="",$(".orderbox .pro_checkbox:checked").each(function(e,c){n=$(this).parent().parent().parent().data("id");var o=new Promise(function(c){$.ajax({type:"get",url:"../api/shoppingCar.php",data:{sqlname:"remove_pro",shoppro_id:n},success:function(e){c(e)}})});o.then(function(e){"yes"==e&&t()})}),a(),t(),alert("删除成功"))})});